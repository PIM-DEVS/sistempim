<div class="chat-container">
  
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2>Mensagens</h2>
      <div class="search-box">
        <i class="bx bx-search"></i>
        <input type="text" placeholder="Buscar conversas..." />
      </div>
    </div>

    <div class="contacts-list">
      <div *ngIf="loadingContatos" style="padding: 20px; text-align: center;">
        <i class="bx bx-loader-alt bx-spin"></i> Carregando contatos...
      </div>

      <div *ngIf="!loadingContatos && contatos.length === 0" style="padding: 20px; text-align: center; color: #999; font-size: 0.9rem;">
        Você precisa seguir alguém para iniciar uma conversa.
      </div>

      <div 
        class="contact-item" 
        *ngFor="let contato of contatos" 
        [class.active]="contato.uid === chatAtivo?.uid"
        (click)="selecionarChat(contato)"
      >
        <div class="contact-avatar">
          <img [src]="contato.fotoPerfil || contato.photoURL || 'assets/images/avatar-default.png'" alt="">
        </div>
        <div class="contact-info">
          <div class="ci-top">
            <span class="name">{{ contato.nome || contato.displayName }}</span>
          </div>
          <p class="last-msg">Clique para conversar</p>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-main" *ngIf="chatAtivo; else emptyState">
    
    <div class="chat-header">
      <div class="user-info">
        <img [src]="chatAtivo.fotoPerfil || chatAtivo.photoURL || 'assets/images/avatar-default.png'" class="header-avatar">
        <div>
          <h3>{{ chatAtivo.nome || chatAtivo.displayName }}</h3>
          <span class="status-text">{{ chatAtivo.email }}</span> </div>
      </div>
      <div class="header-actions">
        <i class="bx bx-dots-vertical-rounded"></i>
      </div>
    </div>

    <div class="messages-area" #scrollContainer>
      
      <ng-container *ngIf="mensagens$ | async as mensagens">
        
        <div *ngIf="mensagens.length === 0" style="text-align: center; padding: 20px; color: #ccc;">
          <small>Nenhuma mensagem ainda. Diga olá!</small>
        </div>

        <div 
          class="msg-bubble" 
          *ngFor="let msg of mensagens"
          [ngClass]="{'sent': msg.senderId === currentUser.uid, 'received': msg.senderId !== currentUser.uid}"
        >
          <p>{{ msg.text }}</p>
          <span class="msg-time">{{ formatarData(msg.timestamp) | date:'HH:mm' }}</span>
        </div>

      </ng-container>

    </div>

    <div class="chat-input-area">
      <input 
        type="text" 
        placeholder="Digite sua mensagem..." 
        [(ngModel)]="mensagemAtual" 
        (keyup.enter)="enviarMensagem()"
      >
      <button class="btn-send" (click)="enviarMensagem()" [disabled]="!mensagemAtual.trim()">
        <i class="bx bx-send"></i>
      </button>
    </div>

  </div>

  <ng-template #emptyState>
    <div class="empty-chat">
      <div class="empty-icon">
        <i class="bx bx-message-square-dots"></i>
      </div>
      <h2>Suas Mensagens</h2>
      <p>Selecione um contato da lista para começar a conversar.</p>
    </div>
  </ng-template>

</div>